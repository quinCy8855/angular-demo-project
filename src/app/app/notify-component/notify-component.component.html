<div class="page">
  <div class="margin-v1">
    <div class="title margin-v1">Case Management</div>
    <input
      class="search-input"
      placeholder="Search"
      (input)="applyFilter($any($event.target).value)"
    />
  </div>

  <div class="table-wrap">
    <table mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="priority" style="max-width: 10px">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>priority</th>
        <td mat-cell *matCellDef="let r" class="priority-cell">
          <img
            class="priority-icon"
            [src]="
              (r.priority || '').trim() === 'URGENT'
                ? 'assets/URGENT.png'
                : 'assets/NORMAL.png'
            "
            [alt]="(r.priority || '').trim()"
          />
        </td>
      </ng-container>
      <ng-container matColumnDef="caseNo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Case No</th>
        <td mat-cell *matCellDef="let r">{{ r.caseNo }}</td>
      </ng-container>

      <ng-container matColumnDef="customerName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Customer</th>
        <td mat-cell *matCellDef="let r">{{ r.customerName }}</td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="left">
          Amount
        </th>
        <td mat-cell *matCellDef="let r" class="left">
          {{ r.amount | number }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td
          class="status-pill"
          [ngClass]="getStatusClass(r.status)"
          mat-cell
          *matCellDef="let r"
        >
          {{ r.status }}
        </td>
      </ng-container>

      <ng-container matColumnDef="updatedAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Updated</th>
        <td mat-cell *matCellDef="let r">{{ r.updatedAt | date: "short" }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>

        <td mat-cell *matCellDef="let r" class="actions-cell">
          <button
            mat-icon-button
            [matMenuTriggerFor]="actionMenu"
            aria-label="Actions"
          >
            <mat-icon>more_vert</mat-icon>
          </button>

          <mat-menu #actionMenu="matMenu">
            <button mat-menu-item (click)="onView(r)">
              <mat-icon>visibility</mat-icon>
              <span>View</span>
            </button>

            <button
              mat-menu-item
              (click)="onEdit(r)"
              [disabled]="r.status === 'APPROVED'"
            >
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>

            <button mat-menu-item class="danger" (click)="onDelete(r)">
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [pageSize]="25"
      [pageSizeOptions]="[10, 25, 50]"
    ></mat-paginator>
  </div>
</div>
